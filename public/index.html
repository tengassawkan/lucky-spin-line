<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lucky Spin</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; }
  #wheel { margin: 20px auto; width: 300px; height: 300px; border-radius: 50%; border: 5px solid #444; line-height: 300px; font-size: 48px; }
  #spin-btn { padding: 10px 20px; font-size: 18px; cursor: pointer; }
  #result { margin-top: 20px; font-size: 20px; font-weight: bold; }
</style>
</head>
<body>

<h2>หมุนวงล้อโชคดี</h2>
<div id="wheel">🎡</div>
<button id="spin-btn">หมุนวงล้อ</button>
<div id="result"></div>

<script>
  const prizes = ['🎉 ส่วนลด 50%', '☕ ฟรีกาแฟ 1 แก้ว', '🍪 ขนมฟรี 1 ชิ้น', '🎁 ของขวัญพิเศษ'];
  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spin-btn');
  const resultDiv = document.getElementById('result');

  async function sendResultToBot(userId, prizeText) {
    try {
      await axios.post('https://lucky-spin-line.onrender.com/api/send-prize', {
        userId,
        prize: prizeText
      });
    } catch (error) {
      alert('ส่งรางวัลล้มเหลว');
      console.error(error);
    }
  }

  spinBtn.addEventListener('click', async () => {
    spinBtn.disabled = true;
    resultDiv.textContent = '';
    wheel.textContent = '🎡 หมุนอยู่...';
    await new Promise(r => setTimeout(r, 3000));
    const index = Math.floor(Math.random() * prizes.length);
    const prize = prizes[index];
    wheel.textContent = '🎡';
    resultDiv.textContent = `คุณได้: ${prize}`;

    // ส่งผลรางวัลกลับบอท
    const profile = await liff.getProfile();
    await sendResultToBot(profile.userId, prize);

    spinBtn.disabled = false;
  });

  window.onload = () => {
    liff.init({ liffId: '2005946547-BPk0z2Kj' }).catch(console.error);
  };
</script>

</body>
</html>
