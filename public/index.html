<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lucky Spin</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; }
  #wheel { margin: 20px auto; width: 300px; height: 300px; border-radius: 50%; border: 5px solid #444; line-height: 300px; font-size: 48px; }
  #spin-btn { padding: 10px 20px; font-size: 18px; cursor: pointer; }
  #result { margin-top: 20px; font-size: 20px; font-weight: bold; }
</style>
</head>
<body>

<h2>à¸«à¸¡à¸¸à¸™à¸§à¸‡à¸¥à¹‰à¸­à¹‚à¸Šà¸„à¸”à¸µ</h2>
<div id="wheel">ðŸŽ¡</div>
<button id="spin-btn">à¸«à¸¡à¸¸à¸™à¸§à¸‡à¸¥à¹‰à¸­</button>
<div id="result"></div>

<script>
  const prizes = ['ðŸŽ‰ à¸ªà¹ˆà¸§à¸™à¸¥à¸” 50%', 'â˜• à¸Ÿà¸£à¸µà¸à¸²à¹à¸Ÿ 1 à¹à¸à¹‰à¸§', 'ðŸª à¸‚à¸™à¸¡à¸Ÿà¸£à¸µ 1 à¸Šà¸´à¹‰à¸™', 'ðŸŽ à¸‚à¸­à¸‡à¸‚à¸§à¸±à¸à¸žà¸´à¹€à¸¨à¸©'];
  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spin-btn');
  const resultDiv = document.getElementById('result');

  async function sendResultToBot(userId, prizeText) {
    try {
      await axios.post('https://lucky-spin-line.onrender.com/api/send-prize', {
        userId,
        prize: prizeText
      });
    } catch (error) {
      alert('à¸ªà¹ˆà¸‡à¸£à¸²à¸‡à¸§à¸±à¸¥à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§');
      console.error(error);
    }
  }

  spinBtn.addEventListener('click', async () => {
    spinBtn.disabled = true;
    resultDiv.textContent = '';
    wheel.textContent = 'ðŸŽ¡ à¸«à¸¡à¸¸à¸™à¸­à¸¢à¸¹à¹ˆ...';
    await new Promise(r => setTimeout(r, 3000));
    const index = Math.floor(Math.random() * prizes.length);
    const prize = prizes[index];
    wheel.textContent = 'ðŸŽ¡';
    resultDiv.textContent = `à¸„à¸¸à¸“à¹„à¸”à¹‰: ${prize}`;

    // à¸ªà¹ˆà¸‡à¸œà¸¥à¸£à¸²à¸‡à¸§à¸±à¸¥à¸à¸¥à¸±à¸šà¸šà¸­à¸—
    const profile = await liff.getProfile();
    await sendResultToBot(profile.userId, prize);

    spinBtn.disabled = false;
  });

  window.onload = () => {
    liff.init({ liffId: '2005946547-BPk0z2Kj' }).catch(console.error);
  };
</script>

</body>
</html>
